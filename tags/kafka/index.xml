<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>kafka on Paulo Oliveira</title><link>/tags/kafka/</link><description>Paulo Oliveira (kafka)</description><generator>Hugo -- gohugo.io</generator><language>pt-BR</language><lastBuildDate>Tue, 18 Aug 2020 00:00:00 +0000</lastBuildDate><atom:link href="/tags/kafka/index.xml" rel="self" type="application/rss+xml"/><item><title>Cliente para Kafka (do zero) em .NET Core - parte 1</title><link>/post/2020-08-18-cliente-kafka-do-zero-net-core-parte-1/</link><pubDate>Tue, 18 Aug 2020 00:00:00 +0000</pubDate><guid>/post/2020-08-18-cliente-kafka-do-zero-net-core-parte-1/</guid><description>&lt;p>Segundo a &lt;a href="https://pt.wikipedia.org/wiki/Protocolo_(ci%C3%AAncia_da_computa%C3%A7%C3%A3o)">Wikipedia&lt;/a> protocolo √© descrito como:&lt;/p>
&lt;blockquote>
&lt;p>&lt;em>Na ci√™ncia da computa√ß√£o, um protocolo √© uma conven√ß√£o que controla e possibilita uma conex√£o, comunica√ß√£o, transfer√™ncia de dados entre dois sistemas computacionais.
De maneira simples, um protocolo pode ser definido como &amp;ldquo;as regras que governam&amp;rdquo; a sintaxe, sem√¢ntica e sincroniza√ß√£o da comunica√ß√£o. Os protocolos podem ser implementados pelo hardware, software ou por uma combina√ß√£o dos dois.&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;p>Faz alguns meses que tenho investido tempo em compreender melhor gerenciamento de mem√≥ria e otimiza√ß√£o com .NET Core, e depois de tanto tempo trabalhando com isso percebo que realmente deveria ter come√ßado antes - antes tarde do nunca n√£o √©?! ü§∑‚Äç‚ôÇÔ∏è.&lt;/p>
&lt;p>Nesse sentido estava a procura de um projeto em que pudesse desenvolver e testar essas capacidades do .NET, e a alguns meses conheci um projeto criado pelo &lt;a href="https://twitter.com/davidfowl">David Fowler&lt;/a> chamado &lt;a href="https://github.com/davidfowl/BedrockFramework">Bedrock Framework&lt;/a>, basicamente √© um conjunto de APIs em .NET Core que pode ser usado para constru√ß√£o de protocolos de comunica√ß√£o entre cliente e servidor, o projeto se basea em novas abstra√ß√µes introduzidas no .NET Core 3 (&lt;a href="https://www.nuget.org/packages/Microsoft.AspNetCore.Connections.Abstractions">Microsoft.AspNetCore.Connections.Abstractions&lt;/a>). Ent√£o voc√™ pode criar seu pr√≥prio servidor que se comunica usando um protocolo customizado, utilizando a infraestrutura do &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.1">Kestrel&lt;/a> e &lt;a href="https://devblogs.microsoft.com/dotnet/system-io-pipelines-high-performance-io-in-net/">System.IO.Pipelines&lt;/a>.&lt;/p>
&lt;p>&lt;em>Neste post, falarei pouco sobre o funcionamento do &lt;a href="https://kafka.apache.org/">Kafka&lt;/a>, n√£o explicarei termos b√°sicos, o foco √© o que se relaciona a comunica√ß√£o e a implementa√ß√£o em .NET, por isso posso citar termos que n√£o terei explicado, mas podem ser facilmente encontrados.&lt;/em>&lt;/p>
&lt;h2 id="kafka">Kafka&lt;/h2>
&lt;p>Como o t√≠tulo deve deixar claro, o meu objetivo √© criar do zero uma implementa√ß√£o do protocolo de comunica√ß√£o com o &lt;a href="https://kafka.apache.org/">Apache Kafka&lt;/a>, n√£o tenho a ambi√ß√£o de cobrir todos os recursos, mas o m√≠nimo para publicar e consumir mensagens.&lt;/p>
&lt;blockquote>
&lt;p>&lt;em>Apache Kafka √© uma plataforma distribu√≠da de fluxo de eventos, √© de c√≥digo-aberto e usado por milhares de companhias para fluxos de alta performace de dados, fluxo de an√°lises, integra√ß√£o de dados, e aplica√ß√µes cr√≠ticas. (&lt;a href="https://kafka.apache.org">https://kafka.apache.org&lt;/a>) [minha tradu√ß√£o livre]&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;p>A &lt;a href="https://kafka.apache.org/protocol.html">documenta√ß√£o&lt;/a> √© muito boa e traz nos detalhes como deve ser feita a comunica√ß√£o. Na Farfetch trabalhamos com Kafka como principal plataforma para comunica√ß√£o ass√≠ncrona entre as aplica√ß√µes, recentemente foi lan√ßado o &lt;a href="https://github.com/Farfetch/kafka-flow">primeiro projeto&lt;/a> open-source da empresa que √© um framework para comunica√ß√£o com Kafka üôÑ.&lt;/p>
&lt;h3 id="comunica√ß√£o">Comunica√ß√£o&lt;/h3>
&lt;p>Kafka usa um protocolo bin√°rio sobre TCP, onde as mensagens de requisi√ß√£o e resposta s√£o aos pares, para cada requisi√ß√£o h√° uma resposta. Todas mensagens s√£o de tamanho delimitado e s√£o constru√≠das com tipos primitivos (char, integer, long e etc). H√° tamb√©m indica√ß√µes para como as conex√µes com os &lt;em>brokers&lt;/em> (n√≥s de um cluster) deve ser geridas, deve se manter uma conex√£o para cada &lt;em>broker&lt;/em>, os servidores v√£o garantir a sequ√™ncia de execu√ß√£o das requisi√ß√µes em uma conex√£o. A conex√£o com os &lt;em>brokers&lt;/em> deve ser mantida por conta de como as mensagens s√£o particionadas pelos &lt;em>brokers&lt;/em> e tamb√©m para obter uma melhor performace.&lt;/p>
&lt;h3 id="particionamento-e-inicializa√ß√£o">Particionamento e Inicializa√ß√£o&lt;/h3>
&lt;p>Kafka, n√£o mant√©m todos os dados em todos os n√≥s do &lt;em>cluster&lt;/em>, o t√≥pico √© criado contando com um n√∫mero de parti√ß√µes inicial, e ent√£o cada parti√ß√£o √© replicada usando um dado fator de replica√ß√£o. As mensagens devem ser publicadas para o &lt;em>broker&lt;/em> que √© o lider para dada parti√ß√£o do t√≥pico, e isso √© poss√≠vel descobrir enviando uma requisi√ß√£o para buscar os metadados do &lt;em>cluster&lt;/em>, voc√™ ter√° a informa√ß√£o de quais &lt;em>brokers&lt;/em> possuem quais t√≥picos e parti√ß√µes, assim pode se ter um cache do lado do cliente com esses metadados e atualizar o cache quando as requisi√ß√µes para publicar ou recuperar mensagens falharem com o c√≥digo de erro &lt;em>&lt;strong>NotLeaderForPartition&lt;/strong>&lt;/em>.&lt;/p>
&lt;h3 id="protocolo">Protocolo&lt;/h3>
&lt;p>Como disse anteriormente as mensagens tem um tamanho delimitado, ou seja, devemos saber exatamente o tamanho da mensagem antes de come√ßar enviar os bytes, isso porque √© com base no tamanho da mensagem que o servidor pode delimitar as mensagens recebidas pelo cliente, o mesmo vale quando o cliente est√° a analisar os dados recebidos do servidor. Os campos obrigat√≥rios para o envio ou leitura de uma mensagem Kafka s√£o os seguintes:&lt;/p>
&lt;h4 id="tamanho-requisi√ß√µesrespostas">Tamanho (requisi√ß√µes/respostas)&lt;/h4>
&lt;p>| Campo | Tipo | Tamanho (bytes) | Descri√ß√£o |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|
| message_size | INT32 | 4 (big-endian) | O campo message_size fornece o tamanho da mensagem de solicita√ß√£o ou resposta subsequente em bytes. |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&lt;/p>
&lt;h4 id="cabe√ßalho-da-requisi√ß√£o">Cabe√ßalho da requisi√ß√£o&lt;/h4>
&lt;p>| Campo | Tipo | Tamanho (bytes) | Descri√ß√£o |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|
| request_api_key | INT16 | 2 (big-endian) | Chave da API desta requisi√ß√£o. |
| request_api_version | INT16 | 2 (big-endian) | Vers√£o da API desta requisi√ß√£o. |
| correlation_id | INT32 | 4 (big-endian) | Identificador de co-rela√ß√£o desta requisi√ß√£o (usado posteriormente para identificar as respostas geradas). |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&lt;/p>
&lt;h4 id="cabe√ßalho-da-resposta">Cabe√ßalho da resposta&lt;/h4>
&lt;p>| Campo | Tipo | Tamanho (bytes) | Descri√ß√£o |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|
| correlation_id | INT32 | 4 (big-endian) | Identificador de co-rela√ß√£o da requisi√ß√£o. |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&lt;/p>
&lt;h2 id="projeto">Projeto&lt;/h2>
&lt;p>Ok, com essas informa√ß√µes acho que j√° podemos come√ßar, e a primeira coisa a fazer √© criar um projeto e definir &amp;ldquo;onde-vai-ficar-o-que&amp;rdquo; üòÖ. Tenho algumas d√∫vidas quanto ao design de uma biblioteca desse tipo e vou tentar esclarece-las nesse processo. Inicialmente penso em &lt;a href="https://github.com/pvoliveira/kafkaraw">KafkaRaw&lt;/a> como um bom nome e n√£o encontrei nada igual no &lt;em>Nuget&lt;/em>, ent√£o ser√° esse o nome do projeto. Tamb√©m n√£o desejo ter/manter compatilidade com vers√µes mais antigas do .NET Core, tudo ser√° baseado no 3.1.&lt;/p>
&lt;p>&lt;img src="/assets/images/kafkaraw-solution.jpg" alt="screenshot da solu√ß√£o inicial">&lt;/p>
&lt;p>Baseado na estrutura b√°sica de uma requisi√ß√£o procurei uma chamada da API que fosse simples e pudesse comprovar o funcionamento do projeto, por fim decidi utilizar a chamada para retornar as vers√µes compat√≠veis da API pelo servidor &lt;a href="https://kafka.apache.org/protocol#The_Messages_ApiVersions">ApiVersions (ApiKey = 18)&lt;/a>, basicamente s√≥ precisamos enviar no cabe√ßalho o &lt;em>ApiKey&lt;/em> da chamada e qual vers√£o queremos usar, neste caso &lt;em>&lt;em>request_api_key&lt;/em>&lt;/em> = 18 e &lt;em>&lt;em>request_api_version&lt;/em>&lt;/em> = 0, o cabe√ßalho &lt;em>&lt;em>correlation_id&lt;/em>&lt;/em> neste caso n√£o tem muita import√¢ncia pois apenas uma chamada ser√° feita, e a vamos analisar a resposta imediatamente ap√≥s a requisi√ß√£o.&lt;/p>
&lt;p>Criei um m√©todo simples para se conectar com os &lt;em>brokers&lt;/em> indicados no construtor da classe e outro para realizar a chamada em si, vamos dar uma olhada neles:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">/// ...
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task ConnectAsync()
{
&lt;span style="color:#66d9ef">foreach&lt;/span> (&lt;span style="color:#66d9ef">var&lt;/span> host &lt;span style="color:#66d9ef">in&lt;/span> _initialBrokers)
{
_connections.TryAdd(host, &lt;span style="color:#66d9ef">await&lt;/span> makeConnection(host));
}
_logger.LogInformation(&lt;span style="color:#e6db74">&amp;#34;Starting Kafka client.&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">async&lt;/span> Task&amp;lt;ConnectionContext&amp;gt; makeConnection(DnsEndPoint h)
{
&lt;span style="color:#66d9ef">var&lt;/span> client = &lt;span style="color:#66d9ef">new&lt;/span> ClientBuilder(_serviceProvider)
.UseSockets()
.UseConnectionLogging()
.Build();
&lt;span style="color:#66d9ef">var&lt;/span> connection = &lt;span style="color:#66d9ef">await&lt;/span> client.ConnectAsync(h);
_logger.LogInformation(&lt;span style="color:#e6db74">$&amp;#34;Connected to {connection.LocalEndPoint}&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> connection;
};
}
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task&amp;lt;ApiVersionsResponse&amp;gt; GetApiVersions()
{
&lt;span style="color:#66d9ef">var&lt;/span> request = &lt;span style="color:#66d9ef">new&lt;/span> ApiVersionsRequest(&lt;span style="color:#ae81ff">18&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span> , &lt;span style="color:#e6db74">&amp;#34;kafkaraw/0.1&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">var&lt;/span> conn = _connections.First();
&lt;span style="color:#66d9ef">var&lt;/span> protocol = &lt;span style="color:#66d9ef">new&lt;/span> Protocols.ApiVersions();
&lt;span style="color:#66d9ef">var&lt;/span> reader = conn.Value.CreateReader();
&lt;span style="color:#66d9ef">var&lt;/span> writer = conn.Value.CreateWriter();
&lt;span style="color:#66d9ef">await&lt;/span> writer.WriteAsync(protocol, request);
&lt;span style="color:#66d9ef">var&lt;/span> result = &lt;span style="color:#66d9ef">await&lt;/span> reader.ReadAsync(protocol);
reader.Advance();
&lt;span style="color:#66d9ef">return&lt;/span> result.Message;
}
&lt;span style="color:#75715e">/// ...
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>No m√©todo &lt;code>ConnectAsync&lt;/code> fazemos a conex√£o com os hosts, podemos ver aqui o uso do &lt;code>ClientBuilder&lt;/code> fornecido pelo &lt;em>Bedrock Framework&lt;/em>, o &lt;em>framework&lt;/em> faz uso de uma &amp;ldquo;API fluente&amp;rdquo; para encadear m√©todos que configuram par√¢metros ou comportamentos do &lt;em>framework&lt;/em>. Nesse caso queremos nos conectar via TCP ao host, por isso o uso do m√©todo &lt;code>UseSockets&lt;/code>, adicionalmente &lt;code>UseConnectionLogging&lt;/code> gerar√° logs da comunica√ß√£o, ao final o m√©todo &lt;code>Build&lt;/code> vai retornar um cliente que cont√©m em si uma inst√¢ncia de &lt;code>IConnectionFactory&lt;/code>, mais especificamente do tipo &lt;code>SocketConnectionFactory&lt;/code> definido pelo m√©todo &lt;code>UseSockets&lt;/code>, o qual abrir√° uma conex√£o com o host e nos devolver√° uma conex√£o pronta para comunica√ß√£o. A conex√£o retornada pelo m√©todo &lt;code>ConnectAsync&lt;/code> do &lt;em>client&lt;/em> √© um &lt;code>ConnectionContext&lt;/code> definido em &lt;code>Microsoft.AspNetCore.Connections.Abstractions&lt;/code>, o &lt;em>framework&lt;/em> implementa &amp;ldquo;uma liga√ß√£o&amp;rdquo; para a escrita/leitura utilizando &lt;code>System.IO.Pipelines.Pipe&lt;/code> para otimizar a aloca√ß√£o de mem√≥ria e performance.&lt;/p>
&lt;p>O m√©todo &lt;code>GetApiVersions&lt;/code> trata das chamadas para realizar a escrita dos dados para a conex√£o e an√°lise da resposta - sem complexidades aqui.&lt;/p>
&lt;p>A classe &lt;code>ApiVersions&lt;/code> √© quem cont√©m a l√≥gica para escrita e leitura para da requisi√ß√£o e resposta, ou seja, a ordem em que devem ser escritos/lidos os bytes.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ApiVersions&lt;/span> :
IMessageReader&amp;lt;ApiVersionsResponse&amp;gt;,
IMessageWriter&amp;lt;ApiVersionsRequest&amp;gt;
{
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> TryParseMessage(&lt;span style="color:#66d9ef">in&lt;/span> ReadOnlySequence&amp;lt;&lt;span style="color:#66d9ef">byte&lt;/span>&amp;gt; input, &lt;span style="color:#66d9ef">ref&lt;/span> SequencePosition consumed, &lt;span style="color:#66d9ef">ref&lt;/span> SequencePosition examined, &lt;span style="color:#66d9ef">out&lt;/span> ApiVersionsResponse message)
{
&lt;span style="color:#66d9ef">var&lt;/span> reader = &lt;span style="color:#66d9ef">new&lt;/span> SequenceReader&amp;lt;&lt;span style="color:#66d9ef">byte&lt;/span>&amp;gt;(input);
&lt;span style="color:#66d9ef">if&lt;/span> (!reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> length)
|| input.Length &amp;lt; length)
{
message = &lt;span style="color:#66d9ef">default&lt;/span>;
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
}
reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> correlationId);
&lt;span style="color:#66d9ef">if&lt;/span> (!reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">short&lt;/span> errorCode)
|| errorCode != &lt;span style="color:#ae81ff">0&lt;/span>)
{
&lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Exception(&lt;span style="color:#e6db74">$&amp;#34;Error Core: {errorCode}&amp;#34;&lt;/span>);
}
ApiKeys[] apiKeys = &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span> (reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> apiKeysLength))
{
apiKeys = &lt;span style="color:#66d9ef">new&lt;/span> ApiKeys[apiKeysLength];
&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i = &lt;span style="color:#ae81ff">0&lt;/span>; i &amp;lt; apiKeysLength; i++)
{
reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">short&lt;/span> apiKey);
reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">short&lt;/span> minVersion);
reader.TryReadBigEndian(&lt;span style="color:#66d9ef">out&lt;/span> &lt;span style="color:#66d9ef">short&lt;/span> maxVersion);
apiKeys[i] = &lt;span style="color:#66d9ef">new&lt;/span> ApiKeys(apiKey, minVersion, maxVersion);
}
}
message = &lt;span style="color:#66d9ef">new&lt;/span> ApiVersionsResponse(errorCode, apiKeys);
consumed = reader.Position;
examined = consumed;
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
}
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> WriteMessage(ApiVersionsRequest message, IBufferWriter&amp;lt;&lt;span style="color:#66d9ef">byte&lt;/span>&amp;gt; output)
{
&lt;span style="color:#66d9ef">var&lt;/span> cltIdBytes = Encoding.UTF8.GetBytes(message.ClientId);
&lt;span style="color:#66d9ef">var&lt;/span> size = &lt;span style="color:#ae81ff">14&lt;/span> + cltIdBytes.Length;
&lt;span style="color:#75715e">// Size
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> sizeBuffer = output.GetSpan(&lt;span style="color:#ae81ff">4&lt;/span>);
BinaryPrimitives.WriteInt32BigEndian(sizeBuffer, size);
output.Advance(&lt;span style="color:#ae81ff">4&lt;/span>);
&lt;span style="color:#75715e">// Header - RequestApiKey
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> rakBuffer = output.GetSpan(&lt;span style="color:#ae81ff">2&lt;/span>);
BinaryPrimitives.WriteInt16BigEndian(rakBuffer, message.RequestApiKey);
output.Advance(&lt;span style="color:#ae81ff">2&lt;/span>);
&lt;span style="color:#75715e">// Header - RequestApiVersion
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> ravBuffer = output.GetSpan(&lt;span style="color:#ae81ff">2&lt;/span>);
BinaryPrimitives.WriteInt16BigEndian(ravBuffer, message.RequestApiVersion);
output.Advance(&lt;span style="color:#ae81ff">2&lt;/span>);
&lt;span style="color:#75715e">// Header - CorrelationId
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> crIdBuffer = output.GetSpan(&lt;span style="color:#ae81ff">4&lt;/span>);
BinaryPrimitives.WriteInt32BigEndian(crIdBuffer, message.CorrelationId);
output.Advance(&lt;span style="color:#ae81ff">4&lt;/span>);
&lt;span style="color:#75715e">// Headers - ClientId
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> cltIdNBuffer = output.GetSpan(&lt;span style="color:#ae81ff">2&lt;/span>);
BinaryPrimitives.WriteInt16BigEndian(cltIdNBuffer, (&lt;span style="color:#66d9ef">short&lt;/span>)cltIdBytes.Length);
output.Advance(&lt;span style="color:#ae81ff">2&lt;/span>);
output.Write(cltIdBytes);
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Com isso feito, √© poss√≠vel criar uma pequena aplica√ß√£o console para por tudo a funcionar ü§û. Para testar, iniciei uma inst√¢ncia do Kafka usando &lt;em>Docker&lt;/em> a ouvir a porta padr√£o 9092.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
{
&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
{
&lt;span style="color:#66d9ef">var&lt;/span> provider = &lt;span style="color:#66d9ef">new&lt;/span> ServiceCollection()
.AddLogging(builder =&amp;gt;
builder
.SetMinimumLevel(LogLevel.Debug)
.AddConsole(opts =&amp;gt; opts.DisableColors = &lt;span style="color:#66d9ef">false&lt;/span>))
.AddKafkaRawClient(&lt;span style="color:#e6db74">&amp;#34;localhost:9092&amp;#34;&lt;/span>)
.BuildServiceProvider();
&lt;span style="color:#66d9ef">await&lt;/span> provider.GetService&amp;lt;IKafkaRawClient&amp;gt;().ConnectAsync();
&lt;span style="color:#66d9ef">var&lt;/span> r = &lt;span style="color:#66d9ef">await&lt;/span> provider.GetService&amp;lt;IKafkaRawClient&amp;gt;().GetApiVersions();
&lt;span style="color:#66d9ef">string&lt;/span> apis = JsonSerializer.Serialize(r, &lt;span style="color:#66d9ef">new&lt;/span> JsonSerializerOptions { WriteIndented = &lt;span style="color:#66d9ef">true&lt;/span> });
provider.GetService&amp;lt;ILogger&amp;lt;Program&amp;gt;&amp;gt;().LogDebug(&lt;span style="color:#e6db74">$&amp;#34;ApiVersions: {apis}&amp;#34;&lt;/span>);
Console.ReadKey();
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Abaixo temos a sa√≠da da execu√ß√£o da aplica√ß√£o console:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">info: KafkaRaw.KafkaRawClient&lt;span style="color:#f92672">[&lt;/span>0&lt;span style="color:#f92672">]&lt;/span>
Connected to &lt;span style="color:#f92672">[&lt;/span>::1&lt;span style="color:#f92672">]&lt;/span>:8662
info: KafkaRaw.KafkaRawClient&lt;span style="color:#f92672">[&lt;/span>0&lt;span style="color:#f92672">]&lt;/span>
Starting Kafka client.
dbug: Bedrock.Framework.LoggingConnectionMiddleware&lt;span style="color:#f92672">[&lt;/span>0&lt;span style="color:#f92672">]&lt;/span>
WriteAsync&lt;span style="color:#f92672">[&lt;/span>26&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">12&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0C 6B &lt;span style="color:#ae81ff">61&lt;/span> &lt;span style="color:#ae81ff">66&lt;/span> 6B &lt;span style="color:#ae81ff">61&lt;/span> &lt;span style="color:#ae81ff">72&lt;/span> &lt;span style="color:#ae81ff">61&lt;/span> &lt;span style="color:#ae81ff">77&lt;/span> 2F &lt;span style="color:#ae81ff">30&lt;/span> 2E &lt;span style="color:#ae81ff">31&lt;/span>
&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>16&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>12&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0Ckafkaraw/0.1
dbug: Bedrock.Framework.LoggingConnectionMiddleware&lt;span style="color:#f92672">[&lt;/span>0&lt;span style="color:#f92672">]&lt;/span>
ReadAsync&lt;span style="color:#f92672">[&lt;/span>302&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> 2A &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">08&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0B &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">05&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">09&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">05&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">06&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">06&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">07&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">08&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">08&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">09&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">06&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0A &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0B &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">06&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0C &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0D &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0E &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 0F &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">05&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">11&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">12&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">13&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">05&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">14&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">04&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">15&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">17&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">03&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">18&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">19&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1A &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1B &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1C &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1D &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1E &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 1F &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">21&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">22&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">23&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">24&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">25&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">26&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">27&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">28&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">29&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2A &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2B &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2C &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">01&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2D &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2E &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> 2F &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">00&lt;/span>
&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01*&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>000&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>08&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0B&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>02&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>05&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>09&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>05&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>02&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>06&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>06&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>07&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>08&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>08&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>09&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>06&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0A&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0B&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>06&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0C&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0D&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0E&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>0F&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>05&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>10&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>11&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>12&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>13&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>05&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>14&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>04&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>15&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>16&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>02&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>17&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>03&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>18&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>19&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1A&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1B&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1C&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>02&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1D&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1E&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>1F&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>&lt;span style="color:#ae81ff">00&lt;/span> &lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>02&lt;span style="color:#ae81ff">\x&lt;/span>00!&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#ae81ff">\x&lt;/span>01&lt;span style="color:#ae81ff">\x&lt;/span>00&lt;span style="color:#e6db74">&amp;#34;\x00\x00\x00\x01\x00#\x00\x00\x00\x01\x00&lt;/span>$&lt;span style="color:#e6db74">\x00\x00\x00\x01\x00%\x00\x00\x00\x01\x00&amp;amp;\x00\x00\x00\x02\x00&amp;#39;\x00\x00\x00\x01\x00(\x00\x00\x00\x01\x00)\x00\x00\x00\x01\x00*\x00\x00\x00\x02\x00+\x00\x00\x00\x02\x00,\x00\x00\x00\x01\x00-\x00\x00\x00\x00\x00.\x00\x00\x00\x00\x00/\x00\x00\x00\x00
&lt;/span>&lt;span style="color:#e6db74">dbug: KafkaClient.Program[0]
&lt;/span>&lt;span style="color:#e6db74"> ApiVersions: {
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ErrorCode&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ApiKeys&lt;span style="color:#e6db74">&amp;#34;: [
&lt;/span>&lt;span style="color:#e6db74"> {
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ApiKey&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MinVersion&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MaxVersion&lt;span style="color:#e6db74">&amp;#34;: 8
&lt;/span>&lt;span style="color:#e6db74"> },
&lt;/span>&lt;span style="color:#e6db74"> {
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ApiKey&lt;span style="color:#e6db74">&amp;#34;: 1,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MinVersion&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MaxVersion&lt;span style="color:#e6db74">&amp;#34;: 11
&lt;/span>&lt;span style="color:#e6db74"> },
&lt;/span>&lt;span style="color:#e6db74"> {
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ApiKey&lt;span style="color:#e6db74">&amp;#34;: 2,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MinVersion&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MaxVersion&lt;span style="color:#e6db74">&amp;#34;: 5
&lt;/span>&lt;span style="color:#e6db74"> },
&lt;/span>&lt;span style="color:#e6db74"> {
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>ApiKey&lt;span style="color:#e6db74">&amp;#34;: 3,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MinVersion&lt;span style="color:#e6db74">&amp;#34;: 0,
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&lt;/span>MaxVersion&lt;span style="color:#e6db74">&amp;#34;: 9
&lt;/span>&lt;span style="color:#e6db74"> },
&lt;/span>&lt;span style="color:#e6db74"> ...
&lt;/span>&lt;span style="color:#e6db74"> ]
&lt;/span>&lt;span style="color:#e6db74"> }
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>E funciona!!! üòÅüòÅüòÅ o m√©todo da API do Kafka chamado retorna qual a vers√£o m√≠nima e m√°xima aceita pelo &lt;em>broker&lt;/em>.&lt;/p>
&lt;h2 id="conclus√£o">Conclus√£o&lt;/h2>
&lt;p>A protocolo de comunica√ß√£o com o Kafka √© bem documentado e ser√° f√°cil seguir implementando novos m√©todos, o pr√≥ximo desafio ser√° organizar o fluxo de comunica√ß√£o: &lt;em>healthchecks&lt;/em>, cache dos metadados do &lt;em>cluster&lt;/em>, e definir quais recursos o &lt;a href="https://github.com/pvoliveira/kafkaraw">KafkaRaw&lt;/a> ir√° expor.&lt;/p>
&lt;p>Tentei ser mais direto poss√≠vel para mostrar como voc√™ pode implementar um protocolo customizado de comunica√ß√£o com .NET Core, por isso n√£o tentei deixar as coisas no &amp;ldquo;melhor estado da arte&amp;rdquo;, e muito menos tocar em performance, gerenciamento de mem√≥ria e etc, mas espero ap√≥s alguns posts chegar a isso. Para qualquer d√∫vida ou discuss√£o, o projeto j√° est√° no &lt;em>GitHub&lt;/em>, pode se abrir uma &lt;em>issue&lt;/em>, deixar um coment√°rio aqui no post ou falar diretamente comigo.&lt;/p>
&lt;p>Muito obrigado e at√© o pr√≥ximo üòé&lt;/p></description></item></channel></rss>